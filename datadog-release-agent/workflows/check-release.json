{
  "objective": "Validate a release by comparing telemetry data before and after for a specified service_name and release_time.\n\n",
  "steps": [
    "## Steps",
    "## Step 1: Define Windows",
    "- Get current time (for reference in output).",
    "- Define windows:",
    "  - **Pre:** `[release_time - N, release_time)`",
    "  - **Post:** `[release_time, release_time + N)`",
    "## Step 2: Log Analysis",
    "- Execute workflow `logs-release-workflow`",
    "- Returns log analysis metrics and chart file IDs if guardrails triggered",
    "## Step 3: Metrics Analysis",
    "- Execute workflow `metrics-release-workflow`.",
    "- Returns categorized metric charts (SYSTEM, RED, CUSTOM) if any metrics show increases",
    "## Step 4: Alerts Analysis",
    "- Execute workflow `triggering-alerts-workflow` for the pre-release timeframe.",
    "- Execute workflow `triggering-alerts-workflow` for the post-release timeframe.",
    "- Identify new alerts post-release that weren't firing pre-release",
    "## Step 5: Dashboard Metrics Analysis",
    "- Execute workflow `search-dashboard-metrics-workflow` for the service_name with release_time and time_window.",
    "- Returns dashboard charts with URLs and metadata",
    "## Step 6: Send Results to Slack",
    "- Aggregate all results from Steps 1-5",
    "- Build final Slack message with categorized sections",
    "- Send exactly one comprehensive message to #alerts-demo on Slack (no partial/progress messages)"
  ],
  "guardrails": [
    "### Slack Send Gate (MUST FOLLOW)",
    "- Do **NOT** send Slack until **all** analysis is complete:",
    "  - Log analysis (warn/error counts, regression flag, pattern detection)",
    "  - Metric analysis (charts categorized by type)",
    "  - Alert analysis (new vs existing)",
    "  - Dashboard metrics (if any found)",
    "### Output Format Instructions (Slack)",
    "- Post **exactly one** Slack message",
    "- Message contains **only Blockit blocks** (no prose, bullets, or extra commentary)",
    "- Always include **Verdict Grid**",
    "#### Grid 1: Verdict (ALWAYS)",
    "Columns:",
    "- `Verdict` (✅ or ⚠️)",
    "- `Service`",
    "- `Release Time`",
    "- `Window`",
    "- `WARN+ % Pre`",
    "- `WARN+ % Post`",
    "- `Delta (pp)`",
    "- `Threshold (pp)`",
    "- `Regression` (PASS/FAIL)",
    "#### Grid 2: Log Issues (ONLY if any log guardrail flagged)",
    "**Include ONLY if:** warn_regression triggered OR new error patterns OR stopped patterns detected",
    "- Timeseries chart showing WARN+ and ERROR logs",
    "- Chart annotated with release boundary",
    "- Log patterns grid (showing NEW and STOPPED patterns):",
    "  - Pattern text",
    "  - Status (NEW, STOPPED, etc.)",
    "  - Pre/Post counts",
    "- Return as **Blockit chart/image blocks** (timeseries chart + pattern table in same section)",
    "#### Grid 3: Metric Issues (ONLY if metrics have post-release increases)",
    "**Include ONLY if:** Any metrics show P50 or P99 increases",
    "- Organize charts by category:",
    "  - **System Metrics** (only if charts exist)",
    "  - **RED Metrics** (only if charts exist)",
    "  - **Custom Metrics** (only if charts exist)",
    "- Each category shows timeseries charts comparing pre vs post",
    "- Charts have release boundary marked clearly",
    "- Return as **Blockit chart/image blocks only** (no tables, no text descriptions)",
    "- Skip categories with no charts",
    "#### Grid 4: Alerts (ONLY if new alerts detected)",
    "**Include ONLY if:** New alerts triggered post-release",
    "- Execute `generate-alerts-blockkit` to render new alerts",
    "- Show alert priority, name, time, and graph",
    "#### Grid 5: Dashboard Metrics (ONLY if dashboards found)",
    "**Include ONLY if:** Dashboards exist for the service",
    "- For each dashboard:",
    "  - Dashboard title and clickable link",
    "  - Timeseries chart for each metric",
    "  - Dashboard URL (clickable)",
    "- Organize by dashboard name",
    "- Limit to top 10 most relevant dashboards",
    "#### Ordering (Include only sections with content)",
    "1. Verdict grid (ALWAYS)",
    "2. Log Issues (if guardrails triggered) - includes both timeseries chart AND pattern table",
    "3. Metric Issues by category (if increases detected):",
    "   - System Metrics (if any)",
    "   - RED Metrics (if any)",
    "   - Custom Metrics (if any)",
    "4. Alerts (if new alerts)",
    "5. Dashboard Metrics (if dashboards found)",
    "#### Hard constraints",
    "- **Logs:** Show timeseries chart + pattern table together in same Log Issues grid (both in same section)",
    "- **Metrics:** Divide charts by category (System/RED/Custom), only show category headers for categories with charts",
    "- **Dashboard:** Show chart + dashboard URL for each metric",
    "- **Alerts:** Stay the same format",
    "- No non-Blockit text in Slack",
    "- Wait for ALL analysis (logs, metrics, alerts, dashboard) to finish before sending"
  ],
  "queries": [],
  "knowledge": [],
  "workflows": [
    "logs-release-workflow",
    "metrics-release-workflow",
    "triggering-alerts-workflow",
    "search-dashboard-metrics-workflow"
  ],
  "scripts": [
    "generate-alerts-blockkit"
  ],
  "trigger": "http"
}