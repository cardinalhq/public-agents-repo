{
  "objective": "Validate a release by comparing telemetry data before and after for a specified service_name and release_time.\n\n",
  "steps": ["## Steps\n\n## Part 1: Define Windows\n- Get current time (for reference in output).\n- Define windows:\n  - **Pre:** `[release_time - N, release_time)`\n  - **Post:** `[release_time, release_time + N)`\n\n## Part 2: Log Analysis\n**Severity**\n- **WARN+** if `level/status ∈ {warn, warning, error, fatal, critical}`\n- **ERROR+** if `level/status ∈ {error, fatal, critical}`\n\n1) **Total logs**\n- `total_pre  = count(logs(service_name, pre))`\n- `total_post = count(logs(service_name, post))`\n\n2) **WARN+ logs**\n- `warn_pre  = count(WARN+ logs in pre)`\n- `warn_post = count(WARN+ logs in post)`\n\n3) **WARN+ rate regression (percentage points)**\n- `pct_pre  = (warn_pre / total_pre) * 100` (0 if `total_pre==0`)\n- `pct_post = (warn_post / total_post) * 100` (0 if `total_post==0`)\n- `delta_pp = pct_post - pct_pre`\n- `warn_regression = (total_pre>0 && total_post>0 && warn_post>=1 && delta_pp >= threshold_pp)`\n\n4) **Stopped patterns (any severity)**\n- Build pattern counts for **all logs** in pre/post using the same patterning logic.\n- Flag **Stopped Pattern** when: `pre_count(pattern) >= min_pattern_count` AND `post_count(pattern) == 0`.\n\n5) **New error patterns (true errors only)**\n- Build pattern counts using **ERROR+ logs only**.\n- Flag **New Error Pattern** when: `pre_err_count(pattern) == 0` AND `post_err_count(pattern) >= min_pattern_count`.\n\n## Part 3: Metrics Analysis\n1. Compare system metrics (**CPU, Memory, Network, Disk**) pre vs post.\n2. Check error metrics for sustained increases post-release.\n3. Check latency metrics (P50/P99) for sustained increases post-release.\n4. For custom metrics: identify critical tags, group by them, compare pre vs post.\n\n## Part 4: Send Results to Slack\n- Send the final results **exactly once** to **Ruchir** on Slack (no partial/progress messages).\n"],
  "guardrails": ["### Slack Send Gate (MUST FOLLOW)\n- Do **not** send Slack until **all** analysis is complete:\n  - `total_pre/total_post`, `warn_pre/warn_post`, `pct_pre/pct_post/delta_pp/warn_regression`\n  - stopped patterns computed (or empty)\n  - new ERROR+ patterns computed (or empty)\n  - metric comparisons + metric flags computed (or none)\n  - all Blockit grids fully constructed\n- Send **exactly one** Slack message. Never send follow-ups.\n\n### Log Analysis Thresholds\n- Flag **WARN+ Regression** if `warn_regression == true` (uses `threshold_pp`, default **20 pp**).\n- Flag **Stopped Pattern** if `pre_count >= min_pattern_count` and `post_count == 0`.\n- Flag **New Error Pattern** only from **ERROR+ logs** where `pre_err_count == 0` and `post_err_count >= min_pattern_count`.\n\n### Metrics Analysis Thresholds\n- Flag latency if **P50 or P99** post-release is **≥ 1.5x** pre-release.\n- Directionality is contextual:\n  - Errors/latency up = bad\n  - Requests down = bad\n\n### Output Format Instructions (Slack)\n- Post **exactly one** Slack message to Ruchir.\n- Message contains **only Blockit grids** (no prose, bullets, or extra commentary).\n- Always include **Verdict Grid**.\n- Include **Log Issues Grid** only if any log guardrail flagged.\n- Include **Metric Issues Grid** only if any metric guardrail flagged.\n- If no issues for a section, omit that grid.\n\n#### Grid 1: Verdict (ALWAYS)\nColumns (exact):\n- `Verdict` (\uD83D\uDC4D or \uD83D\uDC4E)\n- `Service`\n- `Release Time`\n- `Window`\n- `WARN+ % Pre`\n- `WARN+ % Post`\n- `Delta (pp)`\n- `Threshold (pp)`\n- `WARN+ Regression` (PASS/FAIL)\n\nRules:\n- Percent values rounded to **2 decimals**.\n- `Delta (pp) = WARN+ % Post - WARN+ % Pre` (2 decimals).\n- `WARN+ Regression = FAIL` iff `warn_regression == true`, else `PASS`.\n\n#### Grid 2: Log Issues \nColumns (exact):\n- `Issue`\n- `Pattern`\n- `Example`\n- `Pre Count`\n- `Post Count`\n- `Why it matters`\n\nRules:\n- `Issue ∈ {WARN+ Regression, Stopped Pattern, New Error Pattern}`\n- `New Error Pattern` rows must come from **ERROR+ logs only**.\n- `Example` max **140 chars**.\n\n#### Grid 3: Metric Issues\nColumns (exact):\n- `Metric`\n- `Scope` (Overall or tag breakdown label)\n- `Pre`\n- `Post`\n- `Change`\n- `Threshold`\n- `Why it matters`\n\nRules:\n- `Change` formatted as `+X%/-X%` (1 decimal) or `x1.5` for ratios.\n- `Threshold` must match the rule that triggered.\n- Include **only** metrics that triggered a guardrail.\n\n#### Ordering\n- Verdict grid first.\n- Log Issues grid second (if present): `WARN+ Regression` → `New Error Pattern` → `Stopped Pattern`.\n- Metric Issues grid last (if present): errors → latency → requests → system.\n\n#### Hard constraint\n- No non-Blockit text in Slack."],
  "reports": [
    "service-logs-search",
    "service-logs-retrieval",
    "service-request-count",
    "service-request-count-by-dimension",
    "service-error-count",
    "service-error-count-by-dimension",
    "service-error-rate",
    "service-latency-percentiles",
    "http-request-duration-average",
    "http-duration-by-status",
    "average-http-request-duration",
    "server-request-count",
    "client-requests-by-server"
  ],
  "knowledge": [],
  "trigger": "schedule",
  "schedule": "0 0 * * *"
}
