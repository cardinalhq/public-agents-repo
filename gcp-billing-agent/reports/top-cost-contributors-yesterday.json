{
  "name": "top-cost-contributors-yesterday",
  "text": "What are my top 5 cost contributors yesterday?",
  "query_type": "bigquery_sql",
  "query": "SELECT \n  service.description as service_name,\n  SUM(cost) as total_cost,\n  currency,\n  COUNT(*) as cost_entries\nFROM `chip_billing.gcp_billing_export_v1_01D01E_9B88C7_8078BC`\nWHERE cost \u003e 5\n  AND DATE(usage_start_time) = DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY)\nGROUP BY service_name, currency\nORDER BY total_cost DESC\nLIMIT 5",
  "status": "private",
  "meta": {
    "description": "Show the top {max_results} GCP services by total cost for {lookback_days} day(s) ago, filtering to costs greater than {min_cost}",
    "placeholders": [
      {
        "name": "min_cost",
        "original_value": "0",
        "type": "double"
      },
      {
        "name": "lookback_days",
        "original_value": "1",
        "type": "int"
      },
      {
        "name": "max_results",
        "original_value": "5",
        "type": "int"
      }
    ],
    "sql_description": "Show the top {max_results} GCP services by total cost for {lookback_days} day(s) ago, filtering for costs greater than {min_cost}",
    "sql_flow_diagram": "flowchart TD\n    Q[\"Question: What are my top 5 cost contributors yesterday?\"]\n    T1[(\"gcp_billing_export_v1_01D01E_9B88C7_8078BC\")]\n    F1{\"Filter: cost \u003e 0 AND\u003cbr/\u003eDATE(usage_start_time) = yesterday\"}\n    AGG{\"GROUP BY service_name, currency\u003cbr/\u003eSUM(cost) as total_cost\u003cbr/\u003eCOUNT(*) as cost_entries\"}\n    SORT{\"ORDER BY total_cost DESC\"}\n    LIM{\"LIMIT 5\"}\n    R[\"Result: Top 5 services with\u003cbr/\u003eservice_name, total_cost,\u003cbr/\u003ecurrency, cost_entries\"]\n    \n    Q --\u003e T1\n    T1 --\u003e F1\n    F1 --\u003e AGG\n    AGG --\u003e SORT\n    SORT --\u003e LIM\n    LIM --\u003e R",
    "sql_placeholders": [
      {
        "name": "min_cost",
        "original_value": "0",
        "type": "double"
      },
      {
        "name": "lookback_days",
        "original_value": "1",
        "type": "int"
      },
      {
        "name": "max_results",
        "original_value": "5",
        "type": "int"
      }
    ],
    "sql_template": "SELECT \n  service.description as service_name,\n  SUM(cost) as total_cost,\n  currency,\n  COUNT(*) as cost_entries\nFROM `chip_billing.gcp_billing_export_v1_01D01E_9B88C7_8078BC`\nWHERE cost \u003e ?\n  AND DATE(usage_start_time) = DATE_SUB(CURRENT_DATE(), INTERVAL ? DAY)\nGROUP BY service_name, currency\nORDER BY total_cost DESC\nLIMIT ?"
  },
  "datasource_name": "google_bigquery"
}
